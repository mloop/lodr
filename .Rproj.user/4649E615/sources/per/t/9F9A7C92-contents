library(tidyverse)
library(MlBayesOpt)
library(tidyverse)
library(pROC)
source("svm_function.R")

setwd("/home/users/kmdono02/Files_BASIS")
load("long_data_imputed_Oct26.Rdata")
load("Arg_list.Rdata")
arg_value <- as.numeric(Sys.getenv("SLURM_ARRAY_TASK_ID"))

### Convert to Z scores
score_cols <- !grepl("CandID|CHANGE|Group|Site|Gender|Visit", names(long_data_imputed))
long_data_imputed[,score_cols] <- apply(long_data_imputed[,score_cols], 2, as.numeric)
long_data_imputedZ <- long_data_imputed
long_data_imputedZ[,score_cols] <- scale(long_data_imputedZ[,score_cols])

### Generate Test/Train, Validate sets by Group
### For ASD vs No ASD, HR
## Create Month 6 data, separate by group
longdatamonth6 <- long_data_imputedZ %>%
  filter(Visit=="V06") 

## Create Month 12 data
longdatamonth12 <- long_data_imputedZ %>%
  filter(Visit=="V12")

### Run SVM
results <- svmfn_boot(Arg_list$formulas[[arg_value]],
      model_name=Arg_list$models[arg_value], boots=10)

### Save results as object
dir.create(path=paste("/home/users/kmdono02/Files_BASIS/RData_Files",Arg_list$models[arg_value],sep="/"), recursive = TRUE)
save(results,file=paste("/home/users/kmdono02/Files_BASIS/RData_Files",Arg_list$models[arg_value],"results.RData",sep="/"))